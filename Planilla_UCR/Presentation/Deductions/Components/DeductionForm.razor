@page "/newdeduction"
@using Domain.Subscriptions.DTOs
@using Application.Subscriptions
@using Domain.Subscriptions.Entities
@using Presentation.Core.Components

@inject ISubscriptionService SubscriptionService

<MudBreadcrumbs Items="_items" Separator=">"></MudBreadcrumbs>
<MudGrid>
    @*Text fields *@
    <MudItem xs="12" sm="8">
        <MudPaper  Height="250px" Width="90%" Outlined="false" Class="border-none pa-4" Elevation="0">
            <MudToolBar>
            <MudSpacer></MudSpacer> <MudTextField @bind-Value="titulo" Label="" ReadOnly="true" Variant="Variant.Text" /> <MudSpacer></MudSpacer>
            </MudToolBar>
            <MudGrid>
            <MudItem xs="12">
                <MudTextField @bind-Value="name" Label="Nombre" Variant="Variant.Outlined"></MudTextField>
            </MudItem>

            <MudItem xs="6">
                <MudTextField @bind-Value="cost" Label="Costo" Variant="Variant.Outlined"></MudTextField>
            </MudItem>
            
            <MudItem xs="6">
                <MudSelect  @bind-Value="project" Label="Proyecto">
                    <MudSelectItem Value="@("Proyecto 1")">Proyecto 1</MudSelectItem>
                    <MudSelectItem Value="@("Proyecto 2")">Proyecto 2</MudSelectItem>
                </MudSelect>
            </MudItem>
           @*<MudItem xs="6">
                <MudTextField @bind-Value="project" Label="Proyecto" Variant="Variant.Outlined"></MudTextField>
            </MudItem>*@

            <MudItem xs="12">
                <MudTextField @bind-Value="organizationName"  Label="Organizacion" Variant="Variant.Outlined"></MudTextField>
            </MudItem>

            <MudItem xs="12">
                <MudTextField @bind-Value="description" Label="Descripcion" Variant="Variant.Outlined"></MudTextField>
            </MudItem>

            <MudItem xs="12" sm="6" md="4">
               <MudButton Disabled="@_processing" OnClick="ProcessSomething" Variant="Variant.Filled" Color="Color.Secondary">
                    @if (_processing)
                    {
                        <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
                        <MudText Class="ms-2">Procesando</MudText>
                    }
                    else
                    {
                        <MudText>Crear</MudText>
                    }
                </MudButton>
            </MudItem>

            </MudGrid>
        </MudPaper>
    </MudItem>
    @*File uploader *@
    <MudItem xs="3">
            <MudToolBar>
            <MudSpacer></MudSpacer> <MudTextField @bind-Value="deductionPhoto" Label="" ReadOnly="true" Variant="Variant.Text" /> <MudSpacer></MudSpacer>
            </MudToolBar>
          <FileUploader>
          </FileUploader>   
    </MudItem>
</MudGrid>

@code{
    public string name { get; set; }
    public string description { get; set; }
    public string organizationName { get; set; }
    public string project { get; set; }
    public int cost { get; set; }

    public string  titulo { get; set; }  = "                       Añadir deducción";
    public string  deductionPhoto { get; set; }  = "      Foto de la deducción";
    private bool _isLoading = true;
    private bool _processing = false;

    private List<BreadcrumbItem> _items = new List<BreadcrumbItem>
    {
        new BreadcrumbItem("Home", href: ""),
        new BreadcrumbItem("Proyectos", href: null, disabled: true),
        new BreadcrumbItem("Nombre", href: null, disabled: true),
        new BreadcrumbItem("Deducciones", href: "deductions"),
        new BreadcrumbItem("Nuevo", href: "newdeduction")
    };


    async Task ProcessSomething()
    {
        _processing = true;
        Subscription subscription = new Subscription("jeremyvargas.artavia@ucr.ac.cr", name, cost, 0);
        await SubscriptionService.CreateSubscriptionAsync(subscription);
        _processing = false;
    }

     
}