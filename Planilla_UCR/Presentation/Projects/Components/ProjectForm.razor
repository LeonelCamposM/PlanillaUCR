@page "/CreateProject"
@using Domain.Projects.DTOs
@using Domain.Projects.Entities
@using Application.Projects
@using Presentation.Projects.Models
@using Presentation.Core.Components
@using System.ComponentModel.DataAnnotations


@inject IProjectService ProjectService
@inject ISnackbar Snackbar


@*if (_created)
{
    ShowSnackNotification("Proyecto establecido", Severity.Success);
}*@

@{
    List<BreadcrumbItem> _items = new List<BreadcrumbItem>
    {
        new BreadcrumbItem("Inicio", href: "#"),
        new BreadcrumbItem("Proyectos", href: "#"),
        new BreadcrumbItem("Crear Proyecto nuevo", href: "#"),
    };
}
 <MudBreadcrumbs Items="_items" Separator=">"></MudBreadcrumbs>

<MudGrid>
    <MudItem xs="10" sm="12">
        <MudPaper  Height="220px" Width="100%" Outlined="false " Class="border-none pa-4" Elevation="0">
            <MudForm @ref="form">
                <MudText Align="Align.Center" Typo="Typo.h6">Crear Proyecto</MudText>
                <MudGrid>

                <MudItem xs="8">
                    <MudTextField Label="Nombre del Proyecto" Class="mt-3" Variant="Variant.Outlined"  
                    Required="true" RequiredError="Campo requerido"  @bind-Value="ProjectInfo.ProjectName" For="@(() => Limits.ProjectName)">
                    </MudTextField>
                </MudItem>

                <MudDivider />
                <MudItem xs="2"> </MudItem>
                <MudItem xs="8">
                    <MudTextField Label="Email del Empleador"  Class="mt-3" Variant="Variant.Outlined"
                    Required="true" RequiredError="Campo requerido" 
                    @bind-Value="ProjectInfo.EmployerEmail" For="@(() => Limits.Email)" ></MudTextField>
                </MudItem>

                <MudDivider />
                <MudItem xs="2"> </MudItem>
                <MudItem xs="8">
                    <MudTextField Label="Descripción del Proyecto" Variant="Variant.Outlined"
                    @bind-Value="ProjectInfo.ProjectDescription"  For="@(() => Limits.Description )"
                    ></MudTextField>
                </MudItem>
                
                <MudDivider />
                <MudItem xs="2"> </MudItem>
                <MudItem xs="8">
                    <MudSelect typeof="int" @bind-Value="ProjectInfo.PaymentInterval" Label="Intervalo de pago" Variant="Variant.Outlined">
                        <MudSelectItem Value="@("Quincenal")">Pago Quincenal</MudSelectItem>
                        <MudSelectItem Value="@("Mensual")">Pago Mensual</MudSelectItem>
                        <MudSelectItem Value="@("Semanal")">Pago Semanal</MudSelectItem>
                        <MudSelectItem Value="@("Bisemanal")">Pago Bisemanal</MudSelectItem>
                    </MudSelect>
                </MudItem>

                <MudDivider />
                <MudItem xs="2"> </MudItem>
                <MudItem xs="4">
                    @*Cambiar mensaje*@
                    <MudTextField typeof="int" ErrorText="uuuuu" @bind-Value="MaximumAmountForBenefits"  
                    Label="Monto máximo de beneficios" Variant="Variant.Outlined"></MudTextField>
                </MudItem>

                <MudDivider />
                <MudItem xs="4">
                    <MudTextField @bind-Value="MaximumBenefitAmount"  
                    Label="Cantidad máxima de beneficios" Variant="Variant.Outlined"></MudTextField>
                </MudItem>
           
                @*Create buton *@
                <MudDivider />
                <MudItem xs="6">
                    <MudButton Disabled="@snackHandler._saving" OnClick="CreateProject" 
                    Variant="Variant.Filled" Color="Color.Secondary">
                        @if (snackHandler._saving)
                        {
                            <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
                            <MudText Class="ms-2">Creando</MudText>
                        }
                        else
                        {
                            <MudText>Crear</MudText>
                        }
                    </MudButton>

                    <MudButton Disabled="true"> </MudButton>

                    <MudButton OnClick="CleanForm" Variant="Variant.Filled" Color="Color.Transparent">
                        <MudText>Cancelar</MudText>
                    </MudButton>
                </MudItem>
                </MudGrid>
            </MudForm>
        </MudPaper>
    </MudItem>
</MudGrid>

@code{
    public string project { get; set; }
    private bool _isLoading = true;
    private bool _processing = false;
    public double? MaximumAmountForBenefits; 
    public int? MaximumAmountForBenefits; = ProjectInfo.MaximumAmountForBenefits
 

    bool isShow;
    InputType PasswordInput = InputType.Password;
    string PasswordInputIcon = Icons.Material.Filled.VisibilityOff;

    SnackHandler snackHandler = new SnackHandler();
    Project ProjectInfo = new Project("email@gmail.com","Project","",Int32.Parse("0"),Int32.Parse("0"),""); 
    @*porque lo necesita*@
    MudForm form;

    private List<BreadcrumbItem> _items = new List<BreadcrumbItem>
    {
        new BreadcrumbItem("Home", href: ""),
        new BreadcrumbItem("Proyectos", href: "project"),
        new BreadcrumbItem("Crear proyecto nuevo", href: "newproject")
    };


    async Task CreateProject()
    {
        snackHandler._saving = true;
        await ProjectService.CreateProjectAsync(ProjectInfo);
        ShowSnackNotification(ProjectInfo.ProjectName+" creado", Severity.Success);

        snackHandler._saving = false;
    }

    void ShowSnackNotification(string message, Severity severity)
    {
        Snackbar.Configuration.SnackbarVariant = Variant.Filled;
        Snackbar.Configuration.PreventDuplicates = false;
        Snackbar.Configuration.MaxDisplayedSnackbars = 10;
        Snackbar.Configuration.NewestOnTop = true;
        Snackbar.Add($"{message}", severity, config =>
        {
            config.RequireInteraction = false;
            config.ShowCloseIcon = true;
            config.Onclick = snackbar =>
            {
                return Task.CompletedTask;
            };
        });
    }


    void CleanForm()
    {
        ProjectInfo.ProjectName = "";
        ProjectInfo.EmployerEmail = "";
        ProjectInfo.ProjectDescription = "";
        MaximumBenefitAmount= 0;
        MaximumAmountForBenefits = 0;
        ProjectInfo.PaymentInterval = "";
    }

    LimitsValidationForm Limits = new LimitsValidationForm();


    public class LimitsValidationForm
    {
  
        [StringLength(5, ErrorMessage = "El nombre del proyecto es muy grande")]
        public string ProjectName { get; set; }


        [EmailAddress (ErrorMessage = "El Email es inválido")]
        [StringLength(5, ErrorMessage = "El Email es muy grande")]
        public string Email { get; set; }


        [StringLength(5, ErrorMessage = "La descripción es muy grande")]
        public string Description { get; set; }

        [Range(typeof(int), "0", "999999999",
            ErrorMessage = "El valor que ingreso es incorrecto")]
        public object SellEndDate  { get; set; }

    }
    void formatValues(Project ProjectObject, double? MaximumAmountForBenefits,int? MaximumAmountForBenefits;)
    {
        
        
    }
 
}
     
}