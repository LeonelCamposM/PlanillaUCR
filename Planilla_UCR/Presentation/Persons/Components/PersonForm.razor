@page "/persons"
@using Domain.Persons.DTOs
@using Application.Persons
@using Domain.Persons.Entities
@using Presentation.Core.Components

@using Domain.Projects.DTOs
@using Application.Projects
@using Domain.Projects.Entities

@inject IPersonService PersonService

<MudGrid>
    @*Small fields *@
    <MudItem xs="12" sm="7">
        <MudPaper  Height="250px" Width="70%" Outlined="false" Class="border-none pa-4" Elevation="0">
            <MudGrid>
            <MudItem xs="6">
                <MudTextField @bind-Value="name" Label="Nombre" Variant="Variant.Outlined"></MudTextField>
            </MudItem>

            <MudItem xs="6">
                <MudTextField @bind-Value="email" Label="Email" Variant="Variant.Outlined"></MudTextField>
            </MudItem>

            <MudItem xs="6">
                <MudTextField @bind-Value="fname" Label="Primer Apellido" Variant="Variant.Outlined"></MudTextField>
            </MudItem>
            <MudItem xs="6">
                <MudTextField @bind-Value="sname" Label="Segundo Apellido" Variant="Variant.Outlined"></MudTextField>
            </MudItem>
                <MudItem xs="6">
                <MudTextField @bind-Value="phone" Label="Telefono" Variant="Variant.Outlined"></MudTextField>
            </MudItem>
                <MudItem xs="6">
                <MudTextField @bind-Value="id" Label="Cedula" Variant="Variant.Outlined"></MudTextField>
            </MudItem>

             <MudItem xs="12">
                    <MudTextField @bind-Value="direction" Label="Dirección" Variant="Variant.Outlined"></MudTextField>
             </MudItem>
            <MudItem xs="12">
                    <MudTextField @bind-Value="bankAccount" Label="Cuenta Bancaria" Variant="Variant.Outlined"></MudTextField>
            </MudItem>

            <MudItem xs="12">
                <br />
                <MudDivider />
                <br />
            </MudItem>

            <MudItem xs="12" sm="6" md="4">
                <MudButton Disabled="@_processing" OnClick="ProcessSomething" Variant="Variant.Filled" Color="Color.Secondary">
                    @if (_processing)
                    {
                        <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
                        <MudText Class="ms-2">Procesando</MudText>
                    }
                    else
                    {
                        <MudText>Crear</MudText>
                    }
                </MudButton>
            </MudItem>

            </MudGrid>
        </MudPaper>
    </MudItem>

    @*File uploader *@
    <MudItem xs="12" sm="5">
          <FileUploader></FileUploader>   
    </MudItem>
</MudGrid>

@*Big fields *@
<MudGrid>
    @*<MudItem xs="12">
        <MudPaper  Height="150px" Width="50%" Outlined="false" Class="border-none pa-4" Elevation="0">
                    <MudItem xs="12">
                    <MudTextField @bind-Value="direction" Label="Dirección" Variant="Variant.Outlined"></MudTextField>
                    </MudItem>
                    <MudItem xs="12">
                    <MudTextField @bind-Value="bankAccount" Label="Cuenta Bancaria" Variant="Variant.Outlined"></MudTextField>
                    </MudItem>

                    <br />
                    <MudDivider />
                    <br />
                    <MudGrid>
                        <MudItem xs="12" sm="6" md="4">
                            <MudButton Disabled="@_processing" OnClick="ProcessSomething" Variant="Variant.Filled" Color="Color.Secondary">
                                @if (_processing)
                                {
                                    <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
                                    <MudText Class="ms-2">Procesando</MudText>
                                }
                                else
                                {
                                    <MudText>Crear</MudText>
                                }
                            </MudButton>
                        </MudItem>
                    </MudGrid>
        </MudPaper>
     </MudItem>*@
</MudGrid>

@code{
    public string name { get; set; }
    public string email { get; set; }
    public string id { get; set; }
    public string fname { get; set; }
    public string sname { get; set; }
    public string bankAccount { get; set; }
    public string direction { get; set; }
    public string phone { get; set; }
    private bool _isLoading = true;
    private bool _processing = false;

    async Task ProcessSomething()
    {
        _processing = true;
        await PersonService.CreatePersonAsync(email, Int32.Parse(id), name, bankAccount);
        _processing = false;
    }
}